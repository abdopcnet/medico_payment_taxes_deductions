# الواقع: استلمت 110 فعلياً وترغب بخصم 4

## الواقع الفعلي

**الفاتورة = 114**
**استلمت فعلياً = 110**
**تريد خصم = 4**
**تريد: الفاتورة مسددة بالكامل**

## الواقع المحاسبي (من الكود)

### كيف يعمل النظام

من الكود في `add_party_gl_entries()` و `add_deductions_gl_entries()`:

1. **allocated_amount** = المبلغ المخصص للفاتورة (يُستخدم لدفع الفاتورة)
2. **deduction** = نفقة منفصلة (ليس جزء من دفع الفاتورة)

### المعادلة الأساسية

```
paid_amount = allocated_amount + deduction
```

### الحساب

**استلمت = 110**
**خصم = 4**

```
110 = allocated_amount + 4
allocated_amount = 110 - 4 = 106
```

**النتيجة:**
```
الفاتورة = 114
المبلغ المدفوع للفاتورة = 106
المتبقي = 114 - 106 = 8
الفاتورة = "Partly Paid" (متبقي 8)
```

## لماذا لا يمكن دفع الفاتورة بالكامل؟

### لدفع الفاتورة بالكامل:

```
allocated_amount = 114 (مبلغ الفاتورة الكامل)
```

### لكن المعادلة تتطلب:

```
paid_amount = allocated_amount + deduction
110 = 114 + 4 = 118 ❌ (مستحيل!)
```

**المشكلة:** استلمت 110 فقط، لكن النظام يحتاج 118 لدفع الفاتورة (114) + الخصم (4).

## الحلول الممكنة

### الحل 1: بدون خصم (دفع جزئي)

```
Paid Amount = 110
Allocated Amount = 110     (جزء من الفاتورة)
Deduction = 0

النتيجة: الفاتورة متبقية 4 (Partly Paid)
```

### الحل 2: خصم أقل (دفع جزئي)

مثلاً خصم 0 فقط:
```
Paid Amount = 110
Allocated Amount = 110
Deduction = 0

النتيجة: الفاتورة متبقية 4 (Partly Paid)
```

### الحل 3: قبول الواقع (دفع جزئي مع خصم)

```
Paid Amount = 110
Allocated Amount = 106     (110 - 4)
Deduction = 4

النتيجة: الفاتورة متبقية 8 (Partly Paid)
```

## الخلاصة

**الواقع:**
- استلمت 110 فعلياً
- تريد خصم 4
- الفاتورة = 114

**النتيجة المحاسبية:**
- المبلغ المتاح للفاتورة = 110 - 4 = 106
- الفاتورة متبقية = 114 - 106 = 8
- **لا يمكن دفع الفاتورة بالكامل**

**السبب:**
- النظام يحتاج: 114 (فاتورة) + 4 (خصم) = 118
- لكنك استلمت: 110 فقط

**الحلول:**
1. دفع 110 بدون خصم (متبقي 4)
2. قبول الدفع الجزئي (106 للفاتورة + 4 خصم = متبقي 8)
3. الحصول على 8 إضافية (ليصبح 118) ثم دفع الفاتورة بالكامل مع خصم 4

## السؤال

**هل الخصم 4 ضروري أم يمكن تأجيله؟**

إذا كان الخصم ضروري وتم استلام 110 فقط:
- لا يمكن دفع الفاتورة بالكامل
- الفاتورة ستكون "Partly Paid" مع متبقي 8

إذا كان الخصم يمكن تأجيله:
- دفع 110 للفاتورة (متبقي 4)
- معالجة الخصم 4 في payment entry آخر

